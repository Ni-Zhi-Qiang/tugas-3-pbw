<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SITTA UT - Sistem Pemesanan Bahan Ajar</title>
    <link rel="stylesheet" href="assets/css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
</head>
<body>
    <div id="app">
        <!-- Navigation Header -->
        <header class="header">
            <div class="container">
                <h1 class="logo">SITTA UT</h1>
                <nav class="nav">
                    <button v-for="tab in tabs"
                            :key="tab.id"
                            @click="currentTab = tab.id"
                            :class="['nav-btn', { active: currentTab === tab.id }]">
                        {{ tab.name }}
                    </button>
                </nav>
            </div>
        </header>

        <main class="main">
            <div class="container">
                <!-- Halaman Stok -->
                <div v-if="currentTab === 'stok'" class="page">
                    <div class="page-header">
                        <h2>Manajemen Stok Bahan Ajar</h2>
                        <button @click="showAddForm = true" class="btn btn-primary">
                            + Tambah Stok Baru
                        </button>
                    </div>
                    <ba-stock-table :stock-data="stockData"
                                    :upbjj-list="upbjjList"
                                    :kategori-list="kategoriList"
                                    @edit-stock="handleEditStock"
                                    @delete-stock="handleDeleteStock"
                                    @add-stock="handleAddStock"></ba-stock-table>
                </div>

                <!-- Halaman Tracking -->
                <div v-if="currentTab === 'tracking'" class="page">
                    <div class="page-header">
                        <h2>Tracking Delivery Order</h2>
                        <button @click="showOrderForm = true" class="btn btn-primary">
                            + Input DO Baru
                        </button>
                    </div>
                    <do-tracking :tracking-data="trackingData"
                                 :paket-data="paketData"
                                 @add-tracking="handleAddTracking"></do-tracking>
                </div>

                <!-- Halaman Order -->
                <div v-if="currentTab === 'order'" class="page">
                    <h2>Form Pemesanan</h2>
                    <order-form :stock-data="stockData"
                                :upbjj-list="upbjjList"
                                :kategori-list="kategoriList"></order-form>
                </div>
            </div>
        </main>

        <!-- Modal Components -->
        <app-modal v-if="showAddForm"
                   @close="showAddForm = false"
                   title="Tambah Stok Baru">
            <!-- Add Stock Form will go here -->
        </app-modal>

        <app-modal v-if="showOrderForm"
                   @close="showOrderForm = false"
                   title="Input Delivery Order Baru">
            <!-- Order Form will go here -->
        </app-modal>
    </div>

    <!-- Template Components -->
    <script type="text/x-template" id="tpl-stock-table">
        <!-- Stock table template -->
    </script>

    <script type="text/x-template" id="tpl-do-tracking">
        <!-- Tracking template -->
    </script>

    <script type="text/x-template" id="tpl-order-form">
        <!-- Order form template -->
    </script>

    <script type="text/x-template" id="tpl-status-badge">
        <!-- Status badge template -->
    </script>

    <script type="text/x-template" id="tpl-app-modal">
        <!-- Modal template -->
    </script>

    <!-- JavaScript Files -->
    <script src="js/services/api.js"></script>
    <script src="js/components/status-badge.js"></script>
    <script src="js/components/app-modal.js"></script>
    <script src="js/components/stock-table.js"></script>
    <script src="js/components/do-tracking.js"></script>
    <script src="js/components/order-form.js"></script>
    <script src="js/app.js"></script>
</body>
</html>

<!-- Stock Table Template -->
<script type="text/x-template" id="tpl-stock-table">
    <div class="stock-management">
        <!-- Filter Section -->
        <div class="filter-section">
            <div class="filter-group">
                <div class="filter-item">
                    <label>UT Daerah:</label>
                    <select v-model="selectedUPBJJ">
                        <option value="">Semua UPBJJ</option>
                        <option v-for="upbjj in upbjjList" :key="upbjj" :value="upbjj">
                            {{ upbjj }}
                        </option>
                    </select>
                </div>

                <div class="filter-item">
                    <label>Kategori:</label>
                    <select v-model="selectedKategori" :disabled="!selectedUPBJJ">
                        <option value="">Semua Kategori</option>
                        <option v-for="kategori in availableKategories" :key="kategori" :value="kategori">
                            {{ kategori }}
                        </option>
                    </select>
                </div>

                <div class="filter-item">
                    <label>Pencarian:</label>
                    <input type="text"
                           v-model="searchQuery"
                           placeholder="Cari kode, judul, atau lokasi..."
                           @keyup.enter="performSearch">
                </div>
            </div>

            <div class="filter-group mt-20">
                <div class="filter-item">
                    <label>
                        <input type="checkbox" v-model="showLowStock">
                        Tampilkan stok menipis
                    </label>
                </div>

                <div class="filter-item">
                    <label>
                        <input type="checkbox" v-model="showOutOfStock">
                        Tampilkan stok kosong
                    </label>
                </div>

                <div class="filter-item">
                    <button @click="sortBy('judul')" class="btn">
                        Sort by Judul {{ sortField === 'judul' ? (sortDirection === 'asc' ? '↑' : '↓') : '' }}
                    </button>
                </div>

                <div class="filter-item">
                    <button @click="resetFilters" class="btn btn-warning">
                        Reset Filter
                    </button>
                </div>
            </div>
        </div>

        <!-- Statistics -->
        <div class="statistics mb-20">
            <div class="stats-grid">
                <div class="stat-item">
                    <span class="stat-number">{{ statistics.total }}</span>
                    <span class="stat-label">Total Item</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number status-aman">{{ statistics.aman }}</span>
                    <span class="stat-label">Aman</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number status-menipis">{{ statistics.menipis }}</span>
                    <span class="stat-label">Menipis</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number status-kosong">{{ statistics.kosong }}</span>
                    <span class="stat-label">Kosong</span>
                </div>
            </div>
        </div>

        <!-- Stock Table -->
        <div class="table-container">
            <table class="table">
                <thead>
                    <tr>
                        <th>Kode</th>
                        <th>Mata Kuliah</th>
                        <th>Kategori</th>
                        <th>UT Daerah</th>
                        <th>Lokasi Rak</th>
                        <th>Harga</th>
                        <th>Stok</th>
                        <th>Safety Stock</th>
                        <th>Status</th>
                        <th>Aksi</th>
                    </tr>
                </thead>
                <tbody>
                    <tr v-for="item in filteredStock" :key="item.kode">
                        <td><strong>{{ item.kode }}</strong></td>
                        <td>{{ item.judul }}</td>
                        <td>{{ item.kategori }}</td>
                        <td>{{ item.upbjj }}</td>
                        <td>{{ item.lokasiRak }}</td>
                        <td class="text-right">{{ formatCurrency(item.harga) }}</td>
                        <td class="text-right">{{ formatQuantity(item.qty) }}</td>
                        <td class="text-right">{{ formatQuantity(item.safety) }}</td>
                        <td>
                            <status-badge :qty="item.qty" :safety="item.safety"></status-badge>
                            <span class="tooltip-trigger"
                                  @mouseover="showTooltipInfo($event, item.catatanHTML)"
                                  @mouseleave="hideTooltip">
                                ℹ️
                            </span>
                        </td>
                        <td>
                            <button @click="editStock(item)" class="btn btn-primary">
                                Edit
                            </button>
                            <button @click="deleteStock(item)" class="btn btn-danger">
                                Hapus
                            </button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Tooltip -->
        <div v-if="showTooltip"
             class="tooltip"
             :style="{ left: tooltipPosition.x + 'px', top: tooltipPosition.y + 'px' }"
             v-html="tooltipContent"></div>
    </div>
</script>

<!-- DO Tracking Template -->
<script type="text/x-template" id="tpl-do-tracking">
    <div class="tracking-management">
        <!-- Search Section -->
        <div class="filter-section">
            <div class="filter-group">
                <div class="filter-item">
                    <label>Cari berdasarkan:</label>
                    <select v-model="searchType">
                        <option value="nomor">Nomor DO</option>
                        <option value="nim">NIM</option>
                    </select>
                </div>

                <div class="filter-item">
                    <label>Pencarian:</label>
                    <input type="text"
                           v-model="searchQuery"
                           :placeholder="searchType === 'nomor' ? 'Masukkan nomor DO...' : 'Masukkan NIM...'"
                           @keyup.enter="performSearch"
                           @keyup.esc="clearSearch">
                </div>

                <div class="filter-item">
                    <button @click="performSearch" class="btn btn-primary">
                        Cari
                    </button>
                    <button @click="clearSearch" class="btn btn-warning">
                        Clear
                    </button>
                </div>
            </div>
        </div>

        <!-- Search Results -->
        <div v-if="searchResults.length > 0" class="search-results mt-20">
            <h3>Hasil Pencarian</h3>
            <div class="tracking-cards">
                <div v-for="item in searchResults" :key="Object.keys(item)[0]" class="tracking-card">
                    <div class="card-header">
                        <h4>{{ Object.keys(item)[0] }}</h4>
                        <span class="status-badge">{{ Object.values(item)[0].status }}</span>
                    </div>
                    <div class="card-body">
                        <p><strong>NIM:</strong> {{ Object.values(item)[0].nim }}</p>
                        <p><strong>Nama:</strong> {{ Object.values(item)[0].nama }}</p>
                        <p><strong>Ekspedisi:</strong> {{ Object.values(item)[0].ekspedisi }}</p>
                        <p><strong>Tanggal Kirim:</strong> {{ formatDate(Object.values(item)[0].tanggalKirim) }}</p>
                        <p><strong>Total:</strong> {{ formatCurrency(Object.values(item)[0].total) }}</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Add DO Form -->
        <div class="form-section mt-20">
            <h3>Input Delivery Order Baru</h3>
            <div class="form-grid">
                <div class="form-group">
                    <label>Nomor DO:</label>
                    <input type="text" v-model="newDO.nomor" readonly>
                </div>

                <div class="form-group">
                    <label>NIM:</label>
                    <input type="text" v-model="newDO.nim" required>
                </div>

                <div class="form-group">
                    <label>Nama:</label>
                    <input type="text" v-model="newDO.nama" required>
                </div>

                <div class="form-group">
                    <label>Ekspedisi:</label>
                    <select v-model="newDO.ekspedisi">
                        <option value="JNE">JNE</option>
                        <option value="J&T">J&T</option>
                        <option value="Pos Indonesia">Pos Indonesia</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Paket Bahan Ajar:</label>
                    <select v-model="newDO.paket" required>
                        <option value="">Pilih Paket</option>
                        <option v-for="paket in paketData" :key="paket.kode" :value="paket.kode">
                            {{ paket.kode }} - {{ paket.nama }}
                        </option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Tanggal Kirim:</label>
                    <input type="date" v-model="newDO.tanggalKirim" required>
                </div>
            </div>

            <!-- Package Details -->
            <div v-if="selectedPackage" class="package-details mt-20">
                <h4>Detail Paket:</h4>
                <p><strong>Nama Paket:</strong> {{ selectedPackage.nama }}</p>
                <p><strong>Isi Paket:</strong> {{ selectedPackage.isi.join(', ') }}</p>
                <p><strong>Harga:</strong> {{ formatCurrency(selectedPackage.harga) }}</p>
            </div>

            <div class="form-actions">
                <button @click="addNewDO" class="btn btn-primary" @keydown="handleKeydown($event, 'add-do')">
                    Simpan DO
                </button>
                <button @click="resetDOForm" class="btn btn-warning">
                    Reset
                </button>
            </div>
        </div>
    </div>
</script>